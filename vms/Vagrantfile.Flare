Vagrant.configure("2") do |config|
  config.vm.define "FlareVM" do |flare|
    flare.vm.box = "peru/windows-10-enterprise-x64-eval"
    flare.vm.box_version = "20231001.01"

    # Set the VM provider to libvirt with KVM driver
    flare.vm.provider "libvirt" do |libvirt|
      libvirt.driver = "kvm"
      libvirt.memory = 8192  # 8 GB of RAM
      libvirt.cpus = 2       # 2 CPU cores
    end

    # Provisioning script to install Chocolatey and disable Windows updates and UAC
    flare.vm.provision "shell", inline: <<-SHELL
      # Install Chocolatey
      Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))

      # Disable Windows updates
      Stop-Service -Name "wuauserv" -Force
      Set-Service -Name "wuauserv" -StartupType Disabled

      # Disable UAC
      Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name "EnableLUA" -Value 0
    SHELL
  end
end
